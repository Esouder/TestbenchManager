version: '3.7'

services:
  # Your Python/Poetry Application Container
  app:
    image: my-poetry-app:latest
    container_name: python_app_service
    # 1. Define the volume mount
    volumes:
      # Map your host's config directory (e.g., the actual path to your TestbenchConfigs) 
      # to an absolute path inside the container.
      # You must replace './TestbenchConfigs' with the actual path on your host.
      - ./TestbenchConfigs:/app/TestbenchConfigs:ro 
    
    # 2. Update the command to match your manual execution using the container's paths
    command: 
      - "python"
      - "src/testbenchmanager/main.py"
      - "--config-root"
      # The config directory is now mounted at /app/TestbenchConfigs
      - "/app/TestbenchConfigs" 
    
    # Set the working directory to /app, matching where your code is copied in the Dockerfile
    # This is important for the relative 'src/testbenchmanager/main.py' path to work.
    working_dir: /app
    
    networks:
      - app_network
    
    # (Optional: If your app uses an HTTP server, keep these lines or similar)
    # environment:
    #   - PORT=8000
    # ports:
    #   - "8000:8000"

  # Cloudflare Tunnel Connector Container (remains the same)
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared_tunnel
    restart: unless-stopped
    environment:
      - TUNNEL_TOKEN=<YOUR_TUNNEL_TOKEN>
    command: tunnel --no-autoupdate run
    networks:
      - app_network

networks:
  app_network:
    driver: bridge